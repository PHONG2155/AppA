#:kivy 2.3.0
#:import dp kivy.metrics.dp

<GradientBG@FloatLayout>:
    canvas.before:
        # nền xanh đậm
        Color:
            rgba: (0.03, 0.07, 0.15, 1)
        Rectangle:
            pos: self.pos
            size: self.size

        # mảng teal
        Color:
            rgba: (0.0, 0.6, 0.7, 0.22)
        RoundedRectangle:
            pos: self.x - self.width * 0.4, self.y + self.height * 0.45
            size: self.width * 1.6, self.height * 1.1
            radius: [260,260,260,260]

        # mảng tím
        Color:
            rgba: (0.45, 0.3, 0.8, 0.18)
        RoundedRectangle:
            pos: self.x + self.width * 0.15, self.y - self.height * 0.15
            size: self.width * 1.3, self.height * 1.0
            radius: [260,260,260,260]


<GlassCard@BoxLayout>:
    orientation: "vertical"
    size_hint: None, None
    width: dp(320)
    height: dp(480)
    pos_hint: {"center_x": 0.5, "center_y": 0.5}
    padding: dp(24)
    spacing: dp(12)
    canvas.before:
        # nền kính mờ
        Color:
            rgba: (1,1,1,0.07)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [24,24,24,24]
        # viền sáng
        Color:
            rgba: (1,1,1,0.18)
        Line:
            width: 1
            rounded_rectangle: (self.x, self.y, self.width, self.height, 24,24,24,24,100)


<PrimaryButton@Button>:
    size_hint_y: None
    height: dp(50)
    background_normal: ""
    background_down: ""
    font_size: "16sp"
    bold: True
    color: 1,1,1,1
    canvas.before:
        Color:
            rgba: (0.0, 0.45, 0.85, 1)  # xanh fintech
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [14,14,14,14]


<TextButton@ButtonBehavior+Label>:
    size_hint_y: None
    height: dp(24)
    color: 0.5,0.8,1,1
    font_size: "14sp"
    halign: "center"
    valign: "middle"
    text_size: self.size


<LoginScreen>:
    email_input: email_field
    password_input: pw_field
    message_label: login_msg

    GradientBG:
        GlassCard:

            # ----- Tiêu đề -----
            Label:
                text: "Xin chào"
                bold: True
                font_size: "22sp"
                color: 1,1,1,1
                halign: "left"
                valign: "middle"
                text_size: self.size
                size_hint_y: None
                height: dp(30)

            Label:
                text: "Đăng nhập để tiếp tục"
                font_size: "14sp"
                color: .7,.8,.9,1
                halign: "left"
                valign: "middle"
                text_size: self.size
                size_hint_y: None
                height: dp(20)

            # ----- Email label -----
            Label:
                text: "Email"
                font_size: "14sp"
                color: .8,.9,1,1
                size_hint_y: None
                height: dp(20)
                halign: "left"
                valign: "middle"
                text_size: self.size

            # ----- Email input -----
            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: dp(48)
                canvas.before:
                    Color:
                        rgba: 1,1,1,0.08
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [14,14,14,14]
                    Color:
                        rgba: 1,1,1,0.16
                    Line:
                        width: 1
                        rounded_rectangle: (self.x, self.y, self.width, self.height, 14,14,14,14,100)

                TextInput:
                    id: email_field
                    hint_text: "nhập email"
                    background_color: 0,0,0,0
                    foreground_color: 1,1,1,1
                    cursor_color: 1,1,1,1
                    padding: [dp(10), dp(10)]
                    password: False
                    multiline: False
                    font_size: "15sp"

            # ----- Password label -----
            Label:
                text: "Mật khẩu"
                font_size: "14sp"
                color: .8,.9,1,1
                size_hint_y: None
                height: dp(20)
                halign: "left"
                valign: "middle"
                text_size: self.size

            # ----- Password input -----
            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: dp(48)
                canvas.before:
                    Color:
                        rgba: 1,1,1,0.08
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [14,14,14,14]
                    Color:
                        rgba: 1,1,1,0.16
                    Line:
                        width: 1
                        rounded_rectangle: (self.x, self.y, self.width, self.height, 14,14,14,14,100)

                TextInput:
                    id: pw_field
                    hint_text: "••••••"
                    background_color: 0,0,0,0
                    foreground_color: 1,1,1,1
                    cursor_color: 1,1,1,1
                    padding: [dp(10), dp(10)]
                    password: True
                    multiline: False
                    font_size: "15sp"

            # ----- Thông báo (lỗi hoặc OK) -----
            Label:
                id: login_msg
                text: ""
                font_size: "14sp"
                color: 1,0.4,0.4,1
                halign: "center"
                valign: "middle"
                text_size: self.size
                size_hint_y: None
                height: dp(20)

            # ----- Nút đăng nhập -----
            PrimaryButton:
                text: "Đăng nhập"
                on_release: root.do_login()

            # ----- Link đi tới đăng ký -----
            TextButton:
                text: "Chưa có tài khoản? Đăng ký"
                on_release: root.goto_register()


<RegisterScreen>:
    name_input: name_field
    email_input: email_reg_field
    pw_input: pw_reg_field
    pw2_input: pw2_reg_field
    message_label: reg_msg

    GradientBG:
        GlassCard:

            # ----- Tiêu đề -----
            Label:
                text: "Tạo tài khoản"
                bold: True
                font_size: "22sp"
                color: 1,1,1,1
                halign: "left"
                valign: "middle"
                text_size: self.size
                size_hint_y: None
                height: dp(30)

            Label:
                text: "Miễn phí, nhanh chóng"
                font_size: "14sp"
                color: .7,.8,.9,1
                halign: "left"
                valign: "middle"
                text_size: self.size
                size_hint_y: None
                height: dp(20)

            # ----- Họ và tên -----
            Label:
                text: "Họ và tên"
                font_size: "14sp"
                color: .8,.9,1,1
                size_hint_y: None
                height: dp(20)
                halign: "left"
                valign: "middle"
                text_size: self.size

            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: dp(48)
                canvas.before:
                    Color:
                        rgba: 1,1,1,0.08
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [14,14,14,14]
                    Color:
                        rgba: 1,1,1,0.16
                    Line:
                        width: 1
                        rounded_rectangle: (self.x, self.y, self.width, self.height, 14,14,14,14,100)

                TextInput:
                    id: name_field
                    hint_text: "Ví dụ: Nguyễn Văn A"
                    background_color: 0,0,0,0
                    foreground_color: 1,1,1,1
                    cursor_color: 1,1,1,1
                    padding: [dp(10), dp(10)]
                    multiline: False
                    font_size: "15sp"

            # ----- Email -----
            Label:
                text: "Email"
                font_size: "14sp"
                color: .8,.9,1,1
                size_hint_y: None
                height: dp(20)
                halign: "left"
                valign: "middle"
                text_size: self.size

            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: dp(48)
                canvas.before:
                    Color:
                        rgba: 1,1,1,0.08
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [14,14,14,14]
                    Color:
                        rgba: 1,1,1,0.16
                    Line:
                        width: 1
                        rounded_rectangle: (self.x, self.y, self.width, self.height, 14,14,14,14,100)

                TextInput:
                    id: email_reg_field
                    hint_text: "you@example.com"
                    background_color: 0,0,0,0
                    foreground_color: 1,1,1,1
                    cursor_color: 1,1,1,1
                    padding: [dp(10), dp(10)]
                    multiline: False
                    font_size: "15sp"

            # ----- Mật khẩu -----
            Label:
                text: "Mật khẩu"
                font_size: "14sp"
                color: .8,.9,1,1
                size_hint_y: None
                height: dp(20)
                halign: "left"
                valign: "middle"
                text_size: self.size

            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: dp(48)
                canvas.before:
                    Color:
                        rgba: 1,1,1,0.08
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [14,14,14,14]
                    Color:
                        rgba: 1,1,1,0.16
                    Line:
                        width: 1
                        rounded_rectangle: (self.x, self.y, self.width, self.height, 14,14,14,14,100)

                TextInput:
                    id: pw_reg_field
                    hint_text: "ít nhất 4 ký tự"
                    background_color: 0,0,0,0
                    foreground_color: 1,1,1,1
                    cursor_color: 1,1,1,1
                    padding: [dp(10), dp(10)]
                    password: True
                    multiline: False
                    font_size: "15sp"

            # ----- Nhập lại mật khẩu -----
            Label:
                text: "Nhập lại mật khẩu"
                font_size: "14sp"
                color: .8,.9,1,1
                size_hint_y: None
                height: dp(20)
                halign: "left"
                valign: "middle"
                text_size: self.size

            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: dp(48)
                canvas.before:
                    Color:
                        rgba: 1,1,1,0.08
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [14,14,14,14]
                    Color:
                        rgba: 1,1,1,0.16
                    Line:
                        width: 1
                        rounded_rectangle: (self.x, self.y, self.width, self.height, 14,14,14,14,100)

                TextInput:
                    id: pw2_reg_field
                    hint_text: "gõ lại giống ở trên"
                    background_color: 0,0,0,0
                    foreground_color: 1,1,1,1
                    cursor_color: 1,1,1,1
                    padding: [dp(10), dp(10)]
                    password: True
                    multiline: False
                    font_size: "15sp"

            # ----- Thông báo trạng thái -----
            Label:
                id: reg_msg
                text: ""
                font_size: "14sp"
                color: 1,0.4,0.4,1
                halign: "center"
                valign: "middle"
                text_size: self.size
                size_hint_y: None
                height: dp(20)

            # ----- Nút Đăng ký -----
            PrimaryButton:
                text: "Đăng ký"
                on_release: root.do_register()

            # Link quay về đăng nhập
            TextButton:
                text: "Đã có tài khoản? Đăng nhập"
                on_release: root.goto_login()


<HomeScreen>:
    welcome_text: ""
    GradientBG:
        GlassCard:

            Label:
                text: root.welcome_text
                bold: True
                font_size: "22sp"
                color: 1,1,1,1
                halign: "left"
                valign: "middle"
                text_size: self.size
                size_hint_y: None
                height: dp(30)

            Label:
                text: "Bạn đã đăng nhập thành công. Đây là màn hình chính."
                font_size: "14sp"
                color: .7,.8,.9,1
                halign: "left"
                valign: "top"
                text_size: self.size
                size_hint_y: None
                height: dp(40)

            PrimaryButton:
                text: "Đăng xuất"
                on_release:
                    app.current_user = ""
                    root.manager.current = "login"
